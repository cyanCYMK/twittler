<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link href="http://fonts.googleapis.com/css?family=Roboto+Slab:700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="main.css">
    <!-- jQuery UI & jQuery for portBox -->
    <script src="portBox-full-v1.0.1/js/jquery-ui-1.10.3.custom.min.js"></script>
    <script src="portBox-full-v1.0.1/js/jquery.slimscroll.min.js"></script>
    <script src="portBox-full-v1.0.1/js/portBox.min.js"></script>
    <!-- portBox script -->
    <script src="portBox-full-v1.0.1/js/portBox.slimscroll.min.js"></script>
    <!-- portBox CSS -->
    <link href="portBox-full-v1.0.1/css/portBox.css" rel="stylesheet"
  </head>
  <body>
    <script>
      $(document).ready(function(){

        // displays tweets that are an array of objects
        function displayTweets(tweets, element, userID){       
          tweets.forEach(function(tweet, index, tweets){
            var $tweet = $('<div></div>');
            if (typeof userID === 'undefined'){
              $tweet.html('<span class="userID" data-display="user-specific">' + tweet.user + '</span>'
                + '<span class="timestamp">' + tweet.created_at + '</span>'
                + '<br /><span class="message">' + tweet.message + '</span>');            
            } else {
              $tweet.html('<span class="timestamp">' + tweet.created_at + '</span>'
                + '<br /><span class="message">' + tweet.message + '</span>');
            }
            $tweet.prependTo(element);
          });
        }

        // retrieves and displays new tweets
        function getNewTweets(fromIndex){
          var allTweets = streams.home.slice();
          var lastIndex = allTweets.length - 1;
          var newTweets = allTweets.slice(fromIndex+1);
          if (lastIndex > fromIndex){
            displayTweets(newTweets, '.messages');
          }
          return lastIndex;
        }

        // retrieves and displays user specific tweets
        function usersTweets(userID) {
          var $usersBox = $('<div class="users-name">' + userID + '</div>'
            + '<div class="users-tweets"></div>');
          var usersTweets = streams.users[userID];
          displayTweets(usersTweets, '#user-specific', userID);
        }


        // initially display tweets upon load
        var tweets = streams.home.slice();
        var lastIndex = tweets.length - 1;
        displayTweets(tweets, '.messages');
        
        // get new tweets on click
        $('.new-tweets').on('click', function(){
          lastIndex = getNewTweets(lastIndex);
        });

        // get tweets of specific user
        // on click, displayTweets(tweets, '#user-specific', userID)
        // data-display="user-specific"
        $('.messages').on('click', '.userID', function(){
          var userID = $(this).text();
          usersTweets(userID);
        })
/*
        // function to show user's tweets
        var usersTweets = function(userID) {
          var $usersBox = $('<div class="lightbox"><p>Click to close</p><div class="users-content"><div class="username">'+userID+'</div><div class="users-tweets"></div></div></div>');
          var usersTweets = streams.users[userID];
          usersTweets.forEach(function(obj, index){
            var $usersTweet = $('<div></div>')
            $usersTweet.html('<div class="users-tweet"><span class="timestamp">'+ obj.created_at + '</span><br />' + obj.message+'</div>');
            $usersTweet.prependTo($usersBox.find('.users-tweets'));
          });
          $('.user-specific').append($usersBox);
          // remove user's lightbox on click
          $('.lightbox').on('click', function(){
            $('.lightbox').remove();
          });
        };
        // event handler for clicking user's name
        $('.messages').on('click','.userID', function(){
          var userID = $(this).text();
          return usersTweets(userID);
        });
*/
      });

    </script>
    <div class="title">
      <h1>twittler<span class="tagline">a Hack Reactor project</span></h1>
    </div>
  <!--
    <div>
      <a href="#" data-display="test">test</a>
    </div>
    <div id="test" class="portBox">
      testing modal box message
    </div>
  -->
    <div class="tweets">
      <p>Tweets</p>
      <div class="new-tweets">Show new Tweets</div>
      <div class="messages">
      </div>
    </div>
    <div id="user-specific" class="portBox">
    </div>
  </body>
</html>
