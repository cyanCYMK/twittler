<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <script>
      $(document).ready(function(){
        var $body = $('.messages');
        $body.html('');
        
        var tweets = streams.home;
        var index = tweets.length - 1;
        var lastIndex = index;
        var lastTimestamp = tweets[index]['created_at'];

        while(index >= 0){
          var tweet = tweets[index];
          var $tweet = $('<div></div>');
          $tweet.html('@<span class="userID">' + tweet.user + '</span> <span class="timestamp">' + tweet.created_at + '</span><br />' + tweet.message);
          $tweet.appendTo($body);
          index -= 1;
        }

        // button to display new tweets
        $('.new-tweets').on('click', function(){
          // look through streams.home array and find first one that has timestamp greater than lastTimestamp
          var tweetsNow = streams.home;
          for (var i=lastIndex, l=tweetsNow.length; i<l; i++) {
            if (lastTimestamp < tweetsNow[i]['created_at']) {
              var $tweetNew = $('<div></div>');
              $tweetNew.html('@<span class="userID">' + tweetsNow[i].user + '</span> <span class="timestamp">' + tweetsNow[i].created_at + '</span><br />' + tweetsNow[i].message);
              $tweetNew.prependTo($body);
            }
          }
        });
        
        // shows user's tweets
        var usersTweets = function(userID) {
          var usersBox = $('<div id="lightbox"><p>Click to close</p><div class="users-content"></div></div>');
          var usersTweets = streams.users[userID];
          usersTweets.forEach(function(obj, index){
            $(usersBox).find(".users-content").html('<div class="users-tweet">'+ obj.message + '<br />' + obj.created_at+'</div>');
          });
        };

        // event handler for clicking user's name
        $('.messages').on('click','.userID', function(){
          var userID = $(this).text();
          return usersTweets(userID);
        });
      });

    </script>
    <div class="title">
      <h1>twittler<span class="tagline">a Hack Reactor project</span></h1>
    </div>
    <div class="tweets">
      <p>Tweets</p>
      <div class="new-tweets">Show new Tweets</div>
      <div class="messages">
      </div>
    </div>
  </body>
</html>
